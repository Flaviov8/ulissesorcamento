<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerador de Recibo | Locação Escolar</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --primary: #4361ee;
      --success: #4cc9f0;
      --light: #f8f9fa;
      --gray: #6c757d;
      --shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }

    body { background: #f3f4f6; padding: 20px; }

    .container { max-width: 1000px; margin: 0 auto; }

    header {
      text-align: center;
      background: white;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
    }

    h1 { color: var(--primary); font-size: 1.8rem; }
    .subtitle { color: var(--gray); font-size: 1rem; }

    .app-container {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
    }

    .form-container, .preview-container {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: var(--shadow);
      flex: 1;
      min-width: 300px;
    }

    .section-title {
      color: var(--primary);
      font-weight: bold;
      border-bottom: 2px solid var(--primary);
      margin-bottom: 1rem;
      padding-bottom: .3rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 768px) {
      .form-grid { grid-template-columns: 1fr; }
      .app-container { flex-direction: column; }
      h1 { font-size: 1.4rem; }
    }

    label { font-weight: 600; margin-bottom: 4px; display: block; }
    input, select, textarea {
      width: 100%;
      padding: .6rem;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      font-size: 1rem;
    }

    textarea { resize: vertical; min-height: 60px; }

    .payment-options {
      display: flex;
      gap: .5rem;
      flex-wrap: wrap;
    }

    .payment-option {
      flex: 1;
      min-width: 100px;
      text-align: center;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: .5rem;
      cursor: pointer;
      transition: all .2s;
    }

    .payment-option.active { background: var(--primary); color: white; }

    .btn {
      border: none;
      border-radius: 8px;
      padding: .8rem 1rem;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1rem;
      width: 100%;
      transition: 0.2s;
    }

    .btn-primary { background: var(--primary); color: white; }
    .btn-success { background: var(--success); color: white; }
    .btn-outline { border: 2px solid var(--primary); color: var(--primary); background: transparent; }

    .receipt {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid #ccc;
    }

    .receipt-for-pdf {
      width: 210mm;
      height: 297mm;
      padding: 20mm;
      background: white;
      color: black;
      font-size: 12pt;
      line-height: 1.5;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
      box-sizing: border-box;
    }

    @page { size: A4; margin: 0; }

    .receipt-header {
      text-align: center;
      border-bottom: 2px solid black;
      padding-bottom: .5rem;
      margin-bottom: 1rem;
    }

    .receipt-title { font-size: 18pt; font-weight: bold; }
    .receipt-subtitle { color: #666; font-size: 11pt; }

    .receipt-row { display: flex; justify-content: space-between; margin-bottom: .4rem; }

    .receipt-amount {
      border: 2px solid black;
      text-align: center;
      border-radius: 6px;
      margin: 15px 0;
      padding: 10px;
    }

    .amount-value { font-size: 18pt; font-weight: bold; }

    .signature-area {
      text-align: center;
      margin-top: 50px;
    }

    .signature-line {
      border-top: 1px solid #000;
      width: 250px;
      margin: 0 auto;
      margin-bottom: 5px;
    }

    .hash-code {
      text-align: center;
      margin-top: 30px;
      font-size: 10pt;
      color: #555;
      word-break: break-all;
    }

    .hidden { display: none !important; }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 15px;
      background: var(--success);
      color: white;
      border-radius: 8px;
      box-shadow: var(--shadow);
      transform: translateX(150%);
      transition: transform 0.3s ease;
      z-index: 999;
    }
    .notification.show { transform: translateX(0); }
    .notification.error { background: #d9534f; }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-receipt"></i> Gerador de Recibo</h1>
      <p class="subtitle">Crie recibos prontos para impressão em A4</p>
    </header>

    <div class="app-container">
      <!-- FORMULÁRIO -->
      <div class="form-container">
        <h2 class="section-title">Dados do Recibo</h2>
        <div class="form-grid">
          <div>
            <label>Data</label>
            <input type="date" id="receiptDate" value="2025-11-05">
          </div>
          <div>
            <label>Cidade</label>
            <input type="text" id="city" value="Embu das Artes">
          </div>
        </div>

        <h2 class="section-title">Locador</h2>
        <div class="form-grid">
          <div>
            <label>Nome</label>
            <input type="text" id="landlordName" value="Raquel Almeida de Oliveira">
          </div>
          <div>
            <label>Telefone</label>
            <input type="text" id="landlordPhone" value="(11) 99783-5957">
          </div>
        </div>

        <h2 class="section-title">Locatário</h2>
        <label>Nome</label>
        <input type="text" id="tenantName" value="Ulisses Gonzaga">
        <label>Endereço</label>
        <input type="text" id="propertyAddress" value="Av. João Paulo II, 1257 – Jd. Santa Tereza, Embu das Artes - SP">

        <h2 class="section-title">Pagamento</h2>
        <label>Descrição</label>
        <select id="paymentDescription">
          <option selected>Pagamento de Aluguel</option>
          <option>Depósito de garantia</option>
          <option>Serviços de manutenção</option>
        </select>

        <label>Valor (R$)</label>
        <input type="number" id="amount" step="0.01" value="2500.00">

        <label>Forma de pagamento</label>
        <div class="payment-options">
          <div class="payment-option active" data-value="PIX">PIX</div>
          <div class="payment-option" data-value="Cartão de Crédito">Cartão</div>
          <div class="payment-option" data-value="Dinheiro">Dinheiro</div>
        </div>
        <input type="hidden" id="paymentMethod" value="PIX">

        <div id="pixKeyContainer">
          <label>Chave PIX</label>
          <input type="text" id="pixKey" placeholder="Digite a chave PIX" value="raquel.oliveira@email.com">
        </div>

        <h2 class="section-title">Observações</h2>
        <textarea id="observation" placeholder="Digite alguma observação relevante..."></textarea>

        <button class="btn btn-success" id="downloadPDF">Baixar PDF (A4)</button>
      </div>

      <!-- PRÉVIA -->
      <div class="preview-container">
        <h2 class="section-title">Prévia</h2>
        <div class="receipt" id="receiptPreview">
          <div class="receipt-header">
            <h2 class="receipt-title">RECIBO</h2>
            <p class="receipt-subtitle">Comprovante de Pagamento</p>
          </div>
          <div class="receipt-body">
            <div class="receipt-row"><span>Data:</span> <span id="datePreview"></span></div>
            <div class="receipt-row"><span>Cidade:</span> <span id="cityPreview"></span></div>
            <p>Recebi de <strong id="tenantPreview"></strong> a quantia de:</p>
            <div class="receipt-amount">R$ <span id="amountPreview">0,00</span></div>
            <p>Referente a: <span id="descPreview"></span></p>
            <p>Forma de pagamento: <span id="methodPreview"></span></p>
            <p id="pixPreview" class="hidden">Chave PIX: <span></span></p>
            <p><strong>Endereço:</strong> <span id="addressPreview"></span></p>
            <p id="observationPreview" class="hidden"><strong>Observações:</strong> <span></span></p>

            <div class="signature-area">
              <div class="signature-line"></div>
              <p id="landlordPreview"></p>
              <p>Telefone: <span id="phonePreview"></span></p>
            </div>
            <p class="hash-code" id="hashCodePreview"></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification"><i class="fas fa-check-circle"></i> <span></span></div>

  <script>
    // Gera hash único (ID do recibo)
    function generateHash() {
      const random = Math.random().toString(36).substring(2);
      const date = new Date().getTime().toString(36);
      return (random + date).toUpperCase();
    }

    function formatDate(d){
      if(!d) return '';
      const [y,m,day]=d.split('-');
      return `${day}/${m}/${y}`;
    }

    function formatCurrency(v){
      const n=parseFloat(v);
      if(isNaN(n)) return '0,00';
      return n.toLocaleString('pt-BR',{minimumFractionDigits:2});
    }

    function updatePreview(){
      const date=document.getElementById('receiptDate').value;
      const city=document.getElementById('city').value;
      const tenant=document.getElementById('tenantName').value;
      const amount=document.getElementById('amount').value;
      const desc=document.getElementById('paymentDescription').value;
      const method=document.getElementById('paymentMethod').value;
      const pix=document.getElementById('pixKey').value;
      const address=document.getElementById('propertyAddress').value;
      const landlord=document.getElementById('landlordName').value;
      const phone=document.getElementById('landlordPhone').value;
      const obs=document.getElementById('observation').value.trim();
      const hash=generateHash();

      document.getElementById('datePreview').textContent=formatDate(date);
      document.getElementById('cityPreview').textContent=city;
      document.getElementById('tenantPreview').textContent=tenant;
      document.getElementById('amountPreview').textContent=formatCurrency(amount);
      document.getElementById('descPreview').textContent=desc;
      document.getElementById('methodPreview').textContent=method;
      document.getElementById('addressPreview').textContent=address;
      document.getElementById('landlordPreview').textContent=landlord;
      document.getElementById('phonePreview').textContent=phone;
      document.getElementById('hashCodePreview').textContent="Código de Autenticação: #" + hash;

      const pixEl=document.getElementById('pixPreview');
      if(method==='PIX' && pix){
        pixEl.classList.remove('hidden');
        pixEl.querySelector('span').textContent=pix;
      } else pixEl.classList.add('hidden');

      const obsEl=document.getElementById('observationPreview');
      if(obs){
        obsEl.classList.remove('hidden');
        obsEl.querySelector('span').textContent=obs;
      } else obsEl.classList.add('hidden');
    }

    // Atualização em tempo real
    document.querySelectorAll('input, select, textarea').forEach(el => {
      el.addEventListener('input', updatePreview);
      el.addEventListener('change', updatePreview);
    });

    document.querySelectorAll('.payment-option').forEach(el=>{
      el.addEventListener('click',()=>{
        document.querySelectorAll('.payment-option').forEach(p=>p.classList.remove('active'));
        el.classList.add('active');
        const val=el.dataset.value;
        document.getElementById('paymentMethod').value=val;
        document.getElementById('pixKeyContainer').classList.toggle('hidden',val!=='PIX');
        updatePreview();
      });
    });

    document.getElementById('downloadPDF').addEventListener('click',()=>{
      updatePreview();
      const pdf=document.createElement('div');
      pdf.className='receipt-for-pdf';
      pdf.innerHTML=document.getElementById('receiptPreview').innerHTML;
      const opt={
        margin:0,
        filename:`recibo_${new Date().toISOString().split('T')[0]}.pdf`,
        image:{type:'jpeg',quality:0.98},
        html2canvas:{scale:2},
        jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
      };
      html2pdf().set(opt).from(pdf).save();
    });

    updatePreview();
  </script>
</body>
</html>
